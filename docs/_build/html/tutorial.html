

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>1. Tutorial &mdash; Django Test Addons 0.3.3 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="Django Test Addons 0.3.3 documentation" href="index.html"/>
        <link rel="prev" title="Django Test Addons’s documentation!" href="index.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        

        
          <a href="index.html" class="icon icon-home"> Django Test Addons
        

        
        </a>

        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="">1. Tutorial</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#getting-started">1.1. Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="#testing-mongodb">1.2. Testing Mongodb</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#defining-test-settings">1.2.1. Defining test settings</a></li>
<li class="toctree-l3"><a class="reference internal" href="#writing-tests">1.2.2. Writing Tests</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#testing-memcache">1.3. Testing Memcache</a></li>
<li class="toctree-l2"><a class="reference internal" href="#testing-redis">1.4. Testing Redis</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1">1.4.1. Defining test settings</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id2">1.4.2. Writing Tests</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#testing-neo4j-graph-database">1.5. Testing Neo4j Graph database</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id3">1.5.1. Defining test settings</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id4">1.5.2. Writing Tests</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#testing-django-rest-framework-apis">1.6. Testing Django Rest Framework APIs</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id5">1.6.1. Writing Tests</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#composite-testing">1.7. Composite Testing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#composite-test-cases">1.7.1. Composite Test Cases:</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#facing-issues">1.8. Facing Issues</a></li>
</ul>
</li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">Django Test Addons</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>1. Tutorial</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/tutorial.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <div class="section" id="tutorial">
<h1>1. Tutorial<a class="headerlink" href="#tutorial" title="Permalink to this headline">¶</a></h1>
<p>This tutorial provides a step-by-step description on how to use django test addons for
testing different database systems.</p>
<div class="section" id="getting-started">
<h2>1.1. Getting Started<a class="headerlink" href="#getting-started" title="Permalink to this headline">¶</a></h2>
<p>It is recommended to have local installation of respective databases just for testing.
Staging or shared database or any database with critical data should never be used in
testing, as database is cleaned after each test is ran. It is recommended to use a separate
settings file for testing.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last"><strong>Be Careful</strong> to use correct settings for test databases. Using staging or any other database may result in cleaning of the entire database.</p>
</div>
<p>If you haven&#8217;t installed django test addons already, use</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">pip install django-test-addons</span>
</pre></div>
</div>
</div>
<div class="section" id="testing-mongodb">
<h2>1.2. Testing Mongodb<a class="headerlink" href="#testing-mongodb" title="Permalink to this headline">¶</a></h2>
<div class="section" id="defining-test-settings">
<h3>1.2.1. Defining test settings<a class="headerlink" href="#defining-test-settings" title="Permalink to this headline">¶</a></h3>
<p>Make sure you have running installation of mongodb and have mongoengine installed.
Just specify the settings for connection to mongodb instance in the settings file.
Define <em>TEST_MONGO_DATABASE</em> dict in your test file containing connection information.</p>
<p><strong>Example</strong>:</p>
<p>Add this code to test settings file -</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">TEST_MONGO_DATABASE</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;db&#39;</span><span class="p">:</span> <span class="s">&#39;test&#39;</span><span class="p">,</span>
    <span class="s">&#39;host&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;localhost&#39;</span><span class="p">],</span>
    <span class="s">&#39;port&#39;</span><span class="p">:</span> <span class="mi">27017</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Make sure to use same test database for all mongo database aliases. To clarify,
say you have following mongo connection settings in your development/production
settings containing two mongodb aliases.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">MONGO_DATABASES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;default&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">&#39;db&#39;</span><span class="p">:</span> <span class="s">&#39;main&#39;</span><span class="p">,</span>
        <span class="s">&#39;host&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;193.34.32.11&#39;</span><span class="p">],</span> <span class="c"># random development server</span>
        <span class="s">&#39;port&#39;</span><span class="p">:</span> <span class="mi">27017</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="s">&#39;miscellaneous&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">&#39;DB_NAME&#39;</span><span class="p">:</span> <span class="s">&#39;misc&#39;</span><span class="p">,</span>
        <span class="s">&#39;HOST&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;193.34.32.11&#39;</span><span class="p">],</span>
        <span class="s">&#39;PORT&#39;</span><span class="p">:</span> <span class="mi">27017</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In your test settings, make sure to disconnect all existing connections and connect
all mongodb aliases to test db.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># import MONGO_DATABASES variable from development settings file or just use the</span>
<span class="c"># variable if you are using single file for testing with some environment settings.</span>

<span class="kn">import</span> <span class="nn">mongoengine</span>

<span class="n">TEST_MONGO_DATABASE</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;db&#39;</span><span class="p">:</span> <span class="s">&#39;test&#39;</span><span class="p">,</span>
    <span class="s">&#39;host&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;localhost&#39;</span><span class="p">],</span>
    <span class="s">&#39;port&#39;</span><span class="p">:</span> <span class="mi">27017</span><span class="p">,</span>
<span class="p">}</span>

<span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">connection</span><span class="p">:</span> <span class="n">mongoengine</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">disconnect</span><span class="p">(</span><span class="n">connection</span><span class="p">),</span> <span class="n">MONGO_DATABASES</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

<span class="n">MONGO_DATABASES</span> <span class="o">=</span> <span class="p">{</span><span class="n">connection</span><span class="p">:</span> <span class="n">TEST_MONGO_DATABASE</span> <span class="k">for</span> <span class="n">connection</span> <span class="ow">in</span> <span class="n">MONGO_DATABASES</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span>

<span class="k">for</span> <span class="n">connection_name</span><span class="p">,</span> <span class="n">attrs</span> <span class="ow">in</span> <span class="n">MONGO_DATABASES</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">mongoengine</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="o">**</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">([</span><span class="s">&#39;alias&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">attrs</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="p">[</span><span class="n">connection_name</span><span class="p">]</span> <span class="o">+</span> <span class="n">attrs</span><span class="o">.</span><span class="n">values</span><span class="p">())))</span>
</pre></div>
</div>
</div>
<div class="section" id="writing-tests">
<h3>1.2.2. Writing Tests<a class="headerlink" href="#writing-tests" title="Permalink to this headline">¶</a></h3>
<p>Just import <em>MongoTestCase</em> from test_addons, and inherit test class from it.</p>
<p><strong>Example</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">test_addons</span>

<span class="k">class</span> <span class="nc">TestSomething</span><span class="p">(</span><span class="n">test_addons</span><span class="o">.</span><span class="n">MongoTestCase</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">test_instantiation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="testing-memcache">
<h2>1.3. Testing Memcache<a class="headerlink" href="#testing-memcache" title="Permalink to this headline">¶</a></h2>
<p>Just specify <em>CLEAR_CACHE=TRUE</em> in your test class, if you want to clear cache too(it could be Memcache or Redis or any other caching framework that works with django). You must have CACHES configured in your test settings for this to work.</p>
<p><strong>Example</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">test_addons</span>

<span class="k">class</span> <span class="nc">TestSomething</span><span class="p">(</span><span class="n">test_addons</span><span class="o">.</span><span class="n">MongoTestCase</span><span class="p">):</span>

    <span class="n">CLEAR_CACHE</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">test_instantiation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>
</pre></div>
</div>
</div>
<div class="section" id="testing-redis">
<h2>1.4. Testing Redis<a class="headerlink" href="#testing-redis" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id1">
<h3>1.4.1. Defining test settings<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>Make sure you have redis db installed and a running redis server. Just specify
<em>TEST_CACHES</em> dictionary in your test settings containing redis connection info.</p>
<p><strong>Example</strong>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">TEST_CACHES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;default&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">&quot;BACKEND&quot;</span><span class="p">:</span> <span class="s">&quot;django_redis.cache.RedisCache&quot;</span><span class="p">,</span>
        <span class="s">&quot;LOCATION&quot;</span><span class="p">:</span> <span class="s">&quot;127.0.0.1:6379:0&quot;</span><span class="p">,</span>
        <span class="s">&quot;OPTIONS&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">&quot;CLIENT_CLASS&quot;</span><span class="p">:</span> <span class="s">&quot;django_redis.client.DefaultClient&quot;</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="s">&#39;redis1&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">&quot;BACKEND&quot;</span><span class="p">:</span> <span class="s">&quot;django_redis.cache.RedisCache&quot;</span><span class="p">,</span>
        <span class="s">&quot;LOCATION&quot;</span><span class="p">:</span> <span class="s">&quot;127.0.0.1:6379:1&quot;</span><span class="p">,</span>
        <span class="s">&quot;OPTIONS&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">&quot;CLIENT_CLASS&quot;</span><span class="p">:</span> <span class="s">&quot;django_redis.client.DefaultClient&quot;</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">&#8216;django_redis.cache.ShardClient&#8217; does not allow flushing all db as of now, so make sure not to use it. Sharding is not required in testing environment anyway.</p>
</div>
</div>
<div class="section" id="id2">
<h3>1.4.2. Writing Tests<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>Just import <em>RedisTestCase</em> from test_addons, and inherit test class from it.</p>
<p><strong>Example</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">test_addons</span>

<span class="k">class</span> <span class="nc">TestSomething</span><span class="p">(</span><span class="n">test_addons</span><span class="o">.</span><span class="n">RedisTestCase</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">test_instantiation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="testing-neo4j-graph-database">
<h2>1.5. Testing Neo4j Graph database<a class="headerlink" href="#testing-neo4j-graph-database" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id3">
<h3>1.5.1. Defining test settings<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<p>Make sure you have neo4j graph installed and a running neo4j server. Just specify
<em>NEO4J_TEST_LINK</em> pointing to ip address of running neo4j server in your test settings file.</p>
<p><strong>Example</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">NEO4J_TEST_LINK</span> <span class="o">=</span> <span class="s">&#39;http://localhost:7474/db/data&#39;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Since neo4j 2.0, it requires authentication to connection to your neo4j server. Considering it is unnecessary for testing environment, make sure to set &#8216;dbms.security.auth_enabled=false&#8217; in your neo4j-server.properties file</p>
</div>
</div>
<div class="section" id="id4">
<h3>1.5.2. Writing Tests<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<p>Just import <em>Neo4jTestCase</em> from test_addons, and inherit test class from it.</p>
<p><strong>Example</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">test_addons</span>

<span class="k">class</span> <span class="nc">TestSomething</span><span class="p">(</span><span class="n">test_addons</span><span class="o">.</span><span class="n">Neo4jTestCase</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">test_instantiation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="testing-django-rest-framework-apis">
<h2>1.6. Testing Django Rest Framework APIs<a class="headerlink" href="#testing-django-rest-framework-apis" title="Permalink to this headline">¶</a></h2>
<p>It provides support for testing Django rest framework api&#8217;s along with one or
more databases.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Test cases described above would have worked for apis as well, but they use default Test Client provided by Django, whereas it uses Test Client provided by DRF having some additional facilities like forcing authentication.</p>
</div>
<div class="section" id="id5">
<h3>1.6.1. Writing Tests<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<p>Just import APITestCase for the specific database you are using (specify settings accordingly).</p>
<p><em>Available options are</em>:</p>
<blockquote>
<div><ul class="simple">
<li>APIRedisTestCase</li>
<li>APIMongoTestCase</li>
<li>APINeo4jTestCase</li>
<li>APIMongoRedisTestCase</li>
<li>APIRedisMongoNeo4jTestCase</li>
</ul>
</div></blockquote>
<p><strong>Example</strong>
Say we want to use test DRF apis along with mongodb.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">test_addons</span>

<span class="k">class</span> <span class="nc">TestSomething</span><span class="p">(</span><span class="n">test_addons</span><span class="o">.</span><span class="n">APIMongoTestCase</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">test_instantiation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="composite-testing">
<h2>1.7. Composite Testing<a class="headerlink" href="#composite-testing" title="Permalink to this headline">¶</a></h2>
<p>Often multiple databases are used simulataneously, thereby creating the need of
testing them simulataneously. Just to cater this need, django test addons provide
different combinations of TestCases for respective database combinations.</p>
<div class="section" id="composite-test-cases">
<h3>1.7.1. Composite Test Cases:<a class="headerlink" href="#composite-test-cases" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><ul class="simple">
<li>MongoNeo4jTestCase</li>
<li>MongoRedisTestCase</li>
<li>RedisMongoNeo4jTestCase</li>
<li>APIRedisTestCase</li>
<li>APIMongoTestCase</li>
<li>APINeo4jTestCase</li>
<li>APIMongoRedisTestCase</li>
<li>APIRedisMongoNeo4jTestCase</li>
</ul>
</div></blockquote>
</div>
</div>
<div class="section" id="facing-issues">
<h2>1.8. Facing Issues<a class="headerlink" href="#facing-issues" title="Permalink to this headline">¶</a></h2>
<p>Make sure you have defined settings exactly as mentioned. If you still can&#8217;t resolve the issue, you can use <a class="reference external" href="https://groups.google.com/forum/#!forum/django-test-addons">Django test addons mailing list</a> or raise an issue on <a class="reference external" href="https://github.com/hspandher/django-test-addons">github</a>  or just mail me directly at <em>hspandher&#64;outlook.com</em></p>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="index.html" class="btn btn-neutral" title="Django Test Addons’s documentation!" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Hakampreet Singh Pandher.
    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.3.3',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>